name: Daily Redis Cleanup

on:
  schedule:
    - cron: "0 3 * * *"  # K√∂r varje dag kl 03:00 UTC (05:00 svensk tid)
  workflow_dispatch:      # G√∂r det manuellt ocks√•

jobs:
  ping-backend:
    runs-on: ubuntu-latest
    steps:
      - name: Retry Redis cleanup endpoint up to 6 times
        run: |
          n=0
          until [ $n -ge 6 ]
          do
            echo "‚û°Ô∏è Attempt $((n+1))..."
            curl -s -f -X GET https://appeggio-backend.onrender.com/cron/wakeup-clean \
              -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" && echo "‚úÖ Success" && break
            n=$((n+1))
            echo "‚ùå Attempt $n failed. Retrying in 10 seconds..."
            sleep 10
          done

          if [ $n -eq 6 ]; then
            echo "üî• All 6 attempts failed."
            exit 1
          fi

